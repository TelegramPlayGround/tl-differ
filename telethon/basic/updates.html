<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Updates &mdash; Telethon 0.145 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Next Steps" href="next-steps.html" />
    <link rel="prev" title="Quick-Start" href="quick-start.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Telethon
          </a>
              <div class="version">
                0.145
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">First Steps</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="signing-in.html">Signing In</a></li>
<li class="toctree-l1"><a class="reference internal" href="quick-start.html">Quick-Start</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Updates</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting Started</a></li>
<li class="toctree-l2"><a class="reference internal" href="#more-examples">More Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="#entities">Entities</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="next-steps.html">Next Steps</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick-references/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-references/client-reference.html">Client Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-references/events-reference.html">Events Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-references/objects-reference.html">Objects Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../concepts/strings.html">String-based Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/entities.html">Entities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/chats-vs-channels.html">Chats vs Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/updates.html">Updates in Depth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/sessions.html">Session Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/full-api.html">The Full API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/errors.html">RPC Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/botapi-vs-mtproto.html">HTTP Bot API vs MTProto</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/asyncio.html">Mastering asyncio</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Full API Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/word-of-warning.html">A Word of Warning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/chats-and-channels.html">Working with Chats and Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/users.html">Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/working-with-messages.html">Working with messages</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developing/philosophy.html">Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing/test-servers.html">Test Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing/project-structure.html">Project Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing/coding-style.html">Coding Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing/testing.html">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing/understanding-the-type-language.html">Understanding the Type Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing/tips-for-porting-the-project.html">Tips for Porting the Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing/telegram-api-in-other-languages.html">Telegram API in Other Languages</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/changelog.html">Changelog (Version History)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/wall-of-shame.html">Wall of Shame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/compatibility-and-convenience.html">Compatibility and Convenience</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Telethon Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/client.html">TelegramClient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/events.html">Update Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/custom.html">Custom package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/utils.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/errors.html">API Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/sessions.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/network.html">Connection Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/helpers.html">Helpers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Telethon</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Updates</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/basic/updates.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="updates">
<h1>Updates<a class="headerlink" href="#updates" title="Permalink to this heading"></a></h1>
<p>Updates are an important topic in a messaging platform like Telegram.
After all, you want to be notified when a new message arrives, when
a member joins, when someone starts typing, etc.
For that, you can use <strong>events</strong>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>It is strongly advised to enable logging when working with events,
since exceptions in event handlers are hidden by default. Please
add the following snippet to the very top of your file:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;[</span><span class="si">%(levelname) 5s</span><span class="s1">/</span><span class="si">%(asctime)s</span><span class="s1">] </span><span class="si">%(name)s</span><span class="s1">: </span><span class="si">%(message)s</span><span class="s1">&#39;</span><span class="p">,</span>
                    <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">)</span>
</pre></div>
</div>
</div>
<section id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this heading"></a></h2>
<p>Let’s start things with an example to automate replies:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">telethon</span> <span class="kn">import</span> <span class="n">TelegramClient</span><span class="p">,</span> <span class="n">events</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">TelegramClient</span><span class="p">(</span><span class="s1">&#39;anon&#39;</span><span class="p">,</span> <span class="n">api_id</span><span class="p">,</span> <span class="n">api_hash</span><span class="p">)</span>

<span class="nd">@client</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">NewMessage</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">my_event_handler</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;hello&#39;</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">raw_text</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">event</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="s1">&#39;hi!&#39;</span><span class="p">)</span>

<span class="n">client</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="n">client</span><span class="o">.</span><span class="n">run_until_disconnected</span><span class="p">()</span>
</pre></div>
</div>
<p>This code isn’t much, but there might be some things unclear.
Let’s break it down:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">telethon</span> <span class="kn">import</span> <span class="n">TelegramClient</span><span class="p">,</span> <span class="n">events</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">TelegramClient</span><span class="p">(</span><span class="s1">&#39;anon&#39;</span><span class="p">,</span> <span class="n">api_id</span><span class="p">,</span> <span class="n">api_hash</span><span class="p">)</span>
</pre></div>
</div>
<p>This is normal creation (of course, pass session name, API ID and hash).
Nothing we don’t know already.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@client</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">NewMessage</span><span class="p">)</span>
</pre></div>
</div>
<p>This Python decorator will attach itself to the <code class="docutils literal notranslate"><span class="pre">my_event_handler</span></code>
definition, and basically means that <em>on</em> a <a class="reference internal" href="../modules/events.html#telethon.events.newmessage.NewMessage" title="telethon.events.newmessage.NewMessage"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NewMessage</span></code></a> <em>event</em>,
the callback function you’re about to define will be called:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">my_event_handler</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;hello&#39;</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">raw_text</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">event</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="s1">&#39;hi!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If a <a class="reference internal" href="../modules/events.html#telethon.events.newmessage.NewMessage" title="telethon.events.newmessage.NewMessage"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NewMessage</span></code></a> event occurs,
and <code class="docutils literal notranslate"><span class="pre">'hello'</span></code> is in the text of the message, we <a class="reference internal" href="../modules/custom.html#telethon.tl.custom.message.Message.reply" title="telethon.tl.custom.message.Message.reply"><code class="xref py py-obj docutils literal notranslate"><span class="pre">reply()</span></code></a> to the event
with a <code class="docutils literal notranslate"><span class="pre">'hi!'</span></code> message.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Event handlers <strong>must</strong> be <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code>. After all,
Telethon is an asynchronous library based on <code class="xref py py-obj docutils literal notranslate"><span class="pre">asyncio</span></code>,
which is a safer and often faster approach to threads.</p>
<p>You <strong>must</strong> <code class="docutils literal notranslate"><span class="pre">await</span></code> all method calls that use
network requests, which is most of them.</p>
</div>
</section>
<section id="more-examples">
<h2>More Examples<a class="headerlink" href="#more-examples" title="Permalink to this heading"></a></h2>
<p>Replying to messages with hello is fun, but, can we do more?</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@client</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">NewMessage</span><span class="p">(</span><span class="n">outgoing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;\.save&#39;</span><span class="p">))</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">is_reply</span><span class="p">:</span>
        <span class="n">replied</span> <span class="o">=</span> <span class="k">await</span> <span class="n">event</span><span class="o">.</span><span class="n">get_reply_message</span><span class="p">()</span>
        <span class="n">sender</span> <span class="o">=</span> <span class="n">replied</span><span class="o">.</span><span class="n">sender</span>
        <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">download_profile_photo</span><span class="p">(</span><span class="n">sender</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">event</span><span class="o">.</span><span class="n">respond</span><span class="p">(</span><span class="s1">&#39;Saved your photo </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sender</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>
</pre></div>
</div>
<p>We could also get replies. This event filters outgoing messages
(only those that we send will trigger the method), then we filter
by the regex <code class="docutils literal notranslate"><span class="pre">r'\.save'</span></code>, which will match messages starting
with <code class="docutils literal notranslate"><span class="pre">&quot;.save&quot;</span></code>.</p>
<p>Inside the method, we check whether the event is replying to another message
or not. If it is, we get the reply message and the sender of that message,
and download their profile photo.</p>
<p>Let’s delete messages which contain “heck”. We don’t allow swearing here.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@client</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">NewMessage</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;(?i).*heck&#39;</span><span class="p">))</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">event</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</pre></div>
</div>
<p>With the <code class="docutils literal notranslate"><span class="pre">r'(?i).*heck'</span></code> regex, we match case-insensitive
“heck” anywhere in the message. Regex is very powerful and you
can learn more at <a class="reference external" href="https://regexone.com/">https://regexone.com/</a>.</p>
<p>So far, we have only seen the <a class="reference internal" href="../modules/events.html#telethon.events.newmessage.NewMessage" title="telethon.events.newmessage.NewMessage"><code class="xref py py-obj docutils literal notranslate"><span class="pre">NewMessage</span></code></a>, but there are many more
which will be covered later. This is only a small introduction to updates.</p>
</section>
<section id="entities">
<h2>Entities<a class="headerlink" href="#entities" title="Permalink to this heading"></a></h2>
<p>When you need the user or chat where an event occurred, you <strong>must</strong> use
the following methods:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">async</span> <span class="k">def</span> <span class="nf">handler</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="c1"># Good</span>
    <span class="n">chat</span> <span class="o">=</span> <span class="k">await</span> <span class="n">event</span><span class="o">.</span><span class="n">get_chat</span><span class="p">()</span>
    <span class="n">sender</span> <span class="o">=</span> <span class="k">await</span> <span class="n">event</span><span class="o">.</span><span class="n">get_sender</span><span class="p">()</span>
    <span class="n">chat_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">chat_id</span>
    <span class="n">sender_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">sender_id</span>

    <span class="c1"># BAD. Don&#39;t do this</span>
    <span class="n">chat</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">chat</span>
    <span class="n">sender</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">sender</span>
    <span class="n">chat_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span>
    <span class="n">sender_id</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">sender</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</div>
<p>Events are like messages, but don’t have all the information a message has!
When you manually get a message, it will have all the information it needs.
When you receive an update about a message, it <strong>won’t</strong> have all the
information, so you have to <strong>use the methods</strong>, not the properties.</p>
<p>Make sure you understand the code seen here before continuing!
As a rule of thumb, remember that new message events behave just
like message objects, so you can do with them everything you can
do with a message object.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quick-start.html" class="btn btn-neutral float-left" title="Quick-Start" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="next-steps.html" class="btn btn-neutral float-right" title="Next Steps" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017 - 2019, Lonami.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>