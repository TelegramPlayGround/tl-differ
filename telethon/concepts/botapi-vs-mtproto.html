<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HTTP Bot API vs MTProto &mdash; Telethon 0.145 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Mastering asyncio" href="asyncio.html" />
    <link rel="prev" title="RPC Errors" href="errors.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Telethon
          </a>
              <div class="version">
                0.145
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">First Steps</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../basic/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/signing-in.html">Signing In</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/quick-start.html">Quick-Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/updates.html">Updates</a></li>
<li class="toctree-l1"><a class="reference internal" href="../basic/next-steps.html">Next Steps</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Quick References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quick-references/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-references/client-reference.html">Client Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-references/events-reference.html">Events Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quick-references/objects-reference.html">Objects Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Concepts</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="strings.html">String-based Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="entities.html">Entities</a></li>
<li class="toctree-l1"><a class="reference internal" href="chats-vs-channels.html">Chats vs Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="updates.html">Updates in Depth</a></li>
<li class="toctree-l1"><a class="reference internal" href="sessions.html">Session Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="full-api.html">The Full API</a></li>
<li class="toctree-l1"><a class="reference internal" href="errors.html">RPC Errors</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">HTTP Bot API vs MTProto</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#what-is-bot-api">What is Bot API?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#what-is-mtproto">What is MTProto?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advantages-of-mtproto-over-bot-api">Advantages of MTProto over Bot API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#migrating-from-bot-api-to-telethon">Migrating from Bot API to Telethon</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#migrating-from-python-telegram-bot">Migrating from python-telegram-bot</a></li>
<li class="toctree-l3"><a class="reference internal" href="#migrating-from-pytelegrambotapi">Migrating from pyTelegramBotAPI</a></li>
<li class="toctree-l3"><a class="reference internal" href="#migrating-from-aiogram">Migrating from aiogram</a></li>
<li class="toctree-l3"><a class="reference internal" href="#migrating-from-dumbot">Migrating from dumbot</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="asyncio.html">Mastering asyncio</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Full API Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/word-of-warning.html">A Word of Warning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/chats-and-channels.html">Working with Chats and Channels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/users.html">Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/working-with-messages.html">Working with messages</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developing</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developing/philosophy.html">Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing/test-servers.html">Test Servers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing/project-structure.html">Project Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing/coding-style.html">Coding Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing/testing.html">Tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing/understanding-the-type-language.html">Understanding the Type Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing/tips-for-porting-the-project.html">Tips for Porting the Project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developing/telegram-api-in-other-languages.html">Telegram API in Other Languages</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/changelog.html">Changelog (Version History)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/wall-of-shame.html">Wall of Shame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/compatibility-and-convenience.html">Compatibility and Convenience</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Telethon Modules</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules/client.html">TelegramClient</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/events.html">Update Events</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/custom.html">Custom package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/utils.html">Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/errors.html">API Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/sessions.html">Sessions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/network.html">Connection Modes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../modules/helpers.html">Helpers</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Telethon</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">HTTP Bot API vs MTProto</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/concepts/botapi-vs-mtproto.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="http-bot-api-vs-mtproto">
<span id="botapi"></span><h1><a class="toc-backref" href="#id1" role="doc-backlink">HTTP Bot API vs MTProto</a><a class="headerlink" href="#http-bot-api-vs-mtproto" title="Permalink to this heading"></a></h1>
<p>Telethon is more than just another viable alternative when developing bots
for Telegram. If you haven’t decided which wrapper library for bots to use
yet, using Telethon from the beginning may save you some headaches later.</p>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#http-bot-api-vs-mtproto" id="id1">HTTP Bot API vs MTProto</a></p>
<ul>
<li><p><a class="reference internal" href="#what-is-bot-api" id="id2">What is Bot API?</a></p></li>
<li><p><a class="reference internal" href="#what-is-mtproto" id="id3">What is MTProto?</a></p></li>
<li><p><a class="reference internal" href="#advantages-of-mtproto-over-bot-api" id="id4">Advantages of MTProto over Bot API</a></p></li>
<li><p><a class="reference internal" href="#migrating-from-bot-api-to-telethon" id="id5">Migrating from Bot API to Telethon</a></p>
<ul>
<li><p><a class="reference internal" href="#migrating-from-python-telegram-bot" id="id6">Migrating from python-telegram-bot</a></p></li>
<li><p><a class="reference internal" href="#migrating-from-pytelegrambotapi" id="id7">Migrating from pyTelegramBotAPI</a></p></li>
<li><p><a class="reference internal" href="#migrating-from-aiogram" id="id8">Migrating from aiogram</a></p></li>
<li><p><a class="reference internal" href="#migrating-from-dumbot" id="id9">Migrating from dumbot</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="what-is-bot-api">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">What is Bot API?</a><a class="headerlink" href="#what-is-bot-api" title="Permalink to this heading"></a></h2>
<p>The <a class="reference external" href="https://core.telegram.org/bots/api">Telegram Bot API</a>, also known as HTTP Bot API and from now on referred
to as simply “Bot API” is Telegram’s official way for developers to control
their own Telegram bots. Quoting their main page:</p>
<blockquote>
<div><p>The Bot API is an HTTP-based interface created for developers keen on
building bots for Telegram.</p>
<p>To learn how to create and set up a bot, please consult our
<a class="reference external" href="https://core.telegram.org/bots">Introduction to Bots</a> and <a class="reference external" href="https://core.telegram.org/bots/faq">Bot FAQ</a>.</p>
</div></blockquote>
<p>Bot API is simply an HTTP endpoint which translates your requests to it into
MTProto calls through <a class="reference external" href="https://core.telegram.org/tdlib">tdlib</a>, their bot backend.</p>
</section>
<section id="what-is-mtproto">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">What is MTProto?</a><a class="headerlink" href="#what-is-mtproto" title="Permalink to this heading"></a></h2>
<p><a class="reference external" href="https://core.telegram.org/mtproto">MTProto</a> is Telegram’s own protocol to communicate with their API when you
connect to their servers.</p>
<p>Telethon is an alternative MTProto-based backend written entirely in Python
and much easier to setup and use.</p>
<p>Both official applications and third-party clients (like your own
applications) logged in as either user or bots <strong>can use MTProto</strong> to
communicate directly with Telegram’s API (which is not the HTTP bot API).</p>
<p>When we talk about MTProto, we often mean “MTProto-based clients”.</p>
</section>
<section id="advantages-of-mtproto-over-bot-api">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Advantages of MTProto over Bot API</a><a class="headerlink" href="#advantages-of-mtproto-over-bot-api" title="Permalink to this heading"></a></h2>
<p>MTProto clients (like Telethon) connect directly to Telegram’s servers,
which means there is no HTTP connection, no “polling” or “web hooks”. This
means <strong>less overhead</strong>, since the protocol used between you and the server
is much more compact than HTTP requests with responses in wasteful JSON.</p>
<p>Since there is a direct connection to Telegram’s servers, even if their
Bot API endpoint is down, you can still have connection to Telegram directly.</p>
<p>Using a MTProto client, you are also not limited to the public API that
they expose, and instead, <strong>you have full control</strong> of what your bot can do.
Telethon offers you all the power with often <strong>much easier usage</strong> than any
of the available Python Bot API wrappers.</p>
<p>If your application ever needs user features because bots cannot do certain
things, you will be able to easily login as a user and even keep your bot
without having to learn a new library.</p>
<p>If less overhead and full control didn’t convince you to use Telethon yet,
check out the wiki page <a class="reference external" href="https://github.com/LonamiWebs/Telethon/wiki/MTProto-vs-HTTP-Bot-API">MTProto vs HTTP Bot API</a> with a more exhaustive
and up-to-date list of differences.</p>
</section>
<section id="migrating-from-bot-api-to-telethon">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Migrating from Bot API to Telethon</a><a class="headerlink" href="#migrating-from-bot-api-to-telethon" title="Permalink to this heading"></a></h2>
<p>It doesn’t matter if you wrote your bot with <a class="reference external" href="https://pypi.org/project/requests/">requests</a> and you were
making API requests manually, or if you used a wrapper library like
<a class="reference external" href="https://python-telegram-bot.readthedocs.io">python-telegram-bot</a> or <a class="reference external" href="https://github.com/eternnoir/pyTelegramBotAPI">pyTelegramBotAPI</a>. It’s never too late to
migrate to Telethon!</p>
<p>If you were using an asynchronous library like <a class="reference external" href="https://docs.aiohttp.org/en/stable">aiohttp</a> or a wrapper like
<a class="reference external" href="https://aiogram.readthedocs.io">aiogram</a> or <a class="reference external" href="https://github.com/Lonami/dumbot">dumbot</a>, it will be even easier, because Telethon is also an
asynchronous library.</p>
<p>Next, we will see some examples from the most popular libraries.</p>
<section id="migrating-from-python-telegram-bot">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Migrating from python-telegram-bot</a><a class="headerlink" href="#migrating-from-python-telegram-bot" title="Permalink to this heading"></a></h3>
<p>Let’s take their <a class="reference external" href="https://github.com/python-telegram-bot/python-telegram-bot/blob/master/examples/echobot.py">echobot.py</a> example and shorten it a bit:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">telegram.ext</span> <span class="kn">import</span> <span class="n">Updater</span><span class="p">,</span> <span class="n">CommandHandler</span><span class="p">,</span> <span class="n">MessageHandler</span><span class="p">,</span> <span class="n">Filters</span>

<span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">update</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Send a message when the command /start is issued.&quot;&quot;&quot;</span>
    <span class="n">update</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">reply_text</span><span class="p">(</span><span class="s1">&#39;Hi!&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="n">update</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Echo the user message.&quot;&quot;&quot;</span>
    <span class="n">update</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">reply_text</span><span class="p">(</span><span class="n">update</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Start the bot.&quot;&quot;&quot;</span>
    <span class="n">updater</span> <span class="o">=</span> <span class="n">Updater</span><span class="p">(</span><span class="s2">&quot;TOKEN&quot;</span><span class="p">)</span>
    <span class="n">dp</span> <span class="o">=</span> <span class="n">updater</span><span class="o">.</span><span class="n">dispatcher</span>
    <span class="n">dp</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">CommandHandler</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">))</span>
    <span class="n">dp</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">MessageHandler</span><span class="p">(</span><span class="n">Filters</span><span class="o">.</span><span class="n">text</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">Filters</span><span class="o">.</span><span class="n">command</span><span class="p">,</span> <span class="n">echo</span><span class="p">))</span>

    <span class="n">updater</span><span class="o">.</span><span class="n">start_polling</span><span class="p">()</span>

    <span class="n">updater</span><span class="o">.</span><span class="n">idle</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>After using Telethon:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">telethon</span> <span class="kn">import</span> <span class="n">TelegramClient</span><span class="p">,</span> <span class="n">events</span>

<span class="n">bot</span> <span class="o">=</span> <span class="n">TelegramClient</span><span class="p">(</span><span class="s1">&#39;bot&#39;</span><span class="p">,</span> <span class="mi">11111</span><span class="p">,</span> <span class="s1">&#39;a1b2c3d4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">bot_token</span><span class="o">=</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>

<span class="nd">@bot</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">NewMessage</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;/start&#39;</span><span class="p">))</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Send a message when the command /start is issued.&quot;&quot;&quot;</span>
    <span class="k">await</span> <span class="n">event</span><span class="o">.</span><span class="n">respond</span><span class="p">(</span><span class="s1">&#39;Hi!&#39;</span><span class="p">)</span>
    <span class="k">raise</span> <span class="n">events</span><span class="o">.</span><span class="n">StopPropagation</span>

<span class="nd">@bot</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">NewMessage</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Echo the user message.&quot;&quot;&quot;</span>
    <span class="k">await</span> <span class="n">event</span><span class="o">.</span><span class="n">respond</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Start the bot.&quot;&quot;&quot;</span>
    <span class="n">bot</span><span class="o">.</span><span class="n">run_until_disconnected</span><span class="p">()</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
<p>Key differences:</p>
<ul class="simple">
<li><p>The recommended way to do it imports fewer things.</p></li>
<li><p>All handlers trigger by default, so we need <code class="docutils literal notranslate"><span class="pre">events.StopPropagation</span></code>.</p></li>
<li><p>Adding handlers, responding and running is a lot less verbose.</p></li>
<li><p>Telethon needs <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code> and <code class="docutils literal notranslate"><span class="pre">await</span></code>.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">bot</span></code> isn’t hidden away by <code class="docutils literal notranslate"><span class="pre">Updater</span></code> or <code class="docutils literal notranslate"><span class="pre">Dispatcher</span></code>.</p></li>
</ul>
</section>
<section id="migrating-from-pytelegrambotapi">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Migrating from pyTelegramBotAPI</a><a class="headerlink" href="#migrating-from-pytelegrambotapi" title="Permalink to this heading"></a></h3>
<p>Let’s show another echobot from their README:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">telebot</span>

<span class="n">bot</span> <span class="o">=</span> <span class="n">telebot</span><span class="o">.</span><span class="n">TeleBot</span><span class="p">(</span><span class="s2">&quot;TOKEN&quot;</span><span class="p">)</span>

<span class="nd">@bot</span><span class="o">.</span><span class="n">message_handler</span><span class="p">(</span><span class="n">commands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">send_welcome</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
    <span class="n">bot</span><span class="o">.</span><span class="n">reply_to</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="s2">&quot;Howdy, how are you doing?&quot;</span><span class="p">)</span>

<span class="nd">@bot</span><span class="o">.</span><span class="n">message_handler</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">m</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">echo_all</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
    <span class="n">bot</span><span class="o">.</span><span class="n">reply_to</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="n">bot</span><span class="o">.</span><span class="n">polling</span><span class="p">()</span>
</pre></div>
</div>
<p>Now we rewrite it to use Telethon:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">telethon</span> <span class="kn">import</span> <span class="n">TelegramClient</span><span class="p">,</span> <span class="n">events</span>

<span class="n">bot</span> <span class="o">=</span> <span class="n">TelegramClient</span><span class="p">(</span><span class="s1">&#39;bot&#39;</span><span class="p">,</span> <span class="mi">11111</span><span class="p">,</span> <span class="s1">&#39;a1b2c3d4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">bot_token</span><span class="o">=</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>

<span class="nd">@bot</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">NewMessage</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;/start&#39;</span><span class="p">))</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">send_welcome</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">event</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="s1">&#39;Howdy, how are you doing?&#39;</span><span class="p">)</span>

<span class="nd">@bot</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">NewMessage</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">echo_all</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">event</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="n">bot</span><span class="o">.</span><span class="n">run_until_disconnected</span><span class="p">()</span>
</pre></div>
</div>
<p>Key differences:</p>
<ul class="simple">
<li><p>Instead of doing <code class="docutils literal notranslate"><span class="pre">bot.reply_to(message)</span></code>, we can do <code class="docutils literal notranslate"><span class="pre">event.reply</span></code>.
Note that the <code class="docutils literal notranslate"><span class="pre">event</span></code> behaves just like their <code class="docutils literal notranslate"><span class="pre">message</span></code>.</p></li>
<li><p>Telethon also supports <code class="docutils literal notranslate"><span class="pre">func=lambda</span> <span class="pre">m:</span> <span class="pre">True</span></code>, but it’s not necessary.</p></li>
</ul>
</section>
<section id="migrating-from-aiogram">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Migrating from aiogram</a><a class="headerlink" href="#migrating-from-aiogram" title="Permalink to this heading"></a></h3>
<p>From their GitHub:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">aiogram</span> <span class="kn">import</span> <span class="n">Bot</span><span class="p">,</span> <span class="n">Dispatcher</span><span class="p">,</span> <span class="n">executor</span><span class="p">,</span> <span class="n">types</span>

<span class="n">API_TOKEN</span> <span class="o">=</span> <span class="s1">&#39;BOT TOKEN HERE&#39;</span>

<span class="c1"># Initialize bot and dispatcher</span>
<span class="n">bot</span> <span class="o">=</span> <span class="n">Bot</span><span class="p">(</span><span class="n">token</span><span class="o">=</span><span class="n">API_TOKEN</span><span class="p">)</span>
<span class="n">dp</span> <span class="o">=</span> <span class="n">Dispatcher</span><span class="p">(</span><span class="n">bot</span><span class="p">)</span>

<span class="nd">@dp</span><span class="o">.</span><span class="n">message_handler</span><span class="p">(</span><span class="n">commands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">])</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">send_welcome</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This handler will be called when client send `/start` command.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">await</span> <span class="n">message</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="s2">&quot;Hi!</span><span class="se">\n</span><span class="s2">I&#39;m EchoBot!</span><span class="se">\n</span><span class="s2">Powered by aiogram.&quot;</span><span class="p">)</span>

<span class="nd">@dp</span><span class="o">.</span><span class="n">message_handler</span><span class="p">(</span><span class="n">regexp</span><span class="o">=</span><span class="s1">&#39;(^cat[s]?$|puss)&#39;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">cats</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/cats.jpg&#39;</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">photo</span><span class="p">:</span>
        <span class="k">await</span> <span class="n">bot</span><span class="o">.</span><span class="n">send_photo</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">photo</span><span class="p">,</span> <span class="n">caption</span><span class="o">=</span><span class="s1">&#39;Cats is here 😺&#39;</span><span class="p">,</span>
                             <span class="n">reply_to_message_id</span><span class="o">=</span><span class="n">message</span><span class="o">.</span><span class="n">message_id</span><span class="p">)</span>

<span class="nd">@dp</span><span class="o">.</span><span class="n">message_handler</span><span class="p">()</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">echo</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">Message</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">executor</span><span class="o">.</span><span class="n">start_polling</span><span class="p">(</span><span class="n">dp</span><span class="p">,</span> <span class="n">skip_updates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>After rewrite:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">telethon</span> <span class="kn">import</span> <span class="n">TelegramClient</span><span class="p">,</span> <span class="n">events</span>

<span class="c1"># Initialize bot and... just the bot!</span>
<span class="n">bot</span> <span class="o">=</span> <span class="n">TelegramClient</span><span class="p">(</span><span class="s1">&#39;bot&#39;</span><span class="p">,</span> <span class="mi">11111</span><span class="p">,</span> <span class="s1">&#39;a1b2c3d4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">bot_token</span><span class="o">=</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>

<span class="nd">@bot</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">NewMessage</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;/start&#39;</span><span class="p">))</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">send_welcome</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">event</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="s1">&#39;Howdy, how are you doing?&#39;</span><span class="p">)</span>

<span class="nd">@bot</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">NewMessage</span><span class="p">(</span><span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;(^cat[s]?$|puss)&#39;</span><span class="p">))</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">cats</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">event</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="s1">&#39;Cats is here 😺&#39;</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s1">&#39;data/cats.jpg&#39;</span><span class="p">)</span>

<span class="nd">@bot</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="n">events</span><span class="o">.</span><span class="n">NewMessage</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">echo_all</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">event</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">bot</span><span class="o">.</span><span class="n">run_until_disconnected</span><span class="p">()</span>
</pre></div>
</div>
<p>Key differences:</p>
<ul class="simple">
<li><p>Telethon offers convenience methods to avoid retyping
<code class="docutils literal notranslate"><span class="pre">bot.send_photo(message.chat.id,</span> <span class="pre">...)</span></code> all the time,
and instead let you type <code class="docutils literal notranslate"><span class="pre">event.reply</span></code>.</p></li>
<li><p>Sending files is <strong>a lot</strong> easier. The methods for sending
photos, documents, audios, etc. are all the same!</p></li>
</ul>
</section>
<section id="migrating-from-dumbot">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Migrating from dumbot</a><a class="headerlink" href="#migrating-from-dumbot" title="Permalink to this heading"></a></h3>
<p>Showcasing their subclassing example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dumbot</span> <span class="kn">import</span> <span class="n">Bot</span>

<span class="k">class</span> <span class="nc">Subbot</span><span class="p">(</span><span class="n">Bot</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">me</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">getMe</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">update</span><span class="p">):</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">sendMessage</span><span class="p">(</span>
            <span class="n">chat_id</span><span class="o">=</span><span class="n">update</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="s1">&#39;i am </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">me</span><span class="o">.</span><span class="n">username</span><span class="p">)</span>
        <span class="p">)</span>

<span class="n">Subbot</span><span class="p">(</span><span class="n">token</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
<p>After rewriting:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">telethon</span> <span class="kn">import</span> <span class="n">TelegramClient</span><span class="p">,</span> <span class="n">events</span>

<span class="k">class</span> <span class="nc">Subbot</span><span class="p">(</span><span class="n">TelegramClient</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">a</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_event_handler</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">on_update</span><span class="p">,</span> <span class="n">events</span><span class="o">.</span><span class="n">NewMessage</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">connect</span><span class="p">():</span>
        <span class="k">await</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">me</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_me</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">on_update</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
        <span class="k">await</span> <span class="n">event</span><span class="o">.</span><span class="n">reply</span><span class="p">(</span><span class="s1">&#39;i am </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">me</span><span class="o">.</span><span class="n">username</span><span class="p">))</span>

<span class="n">bot</span> <span class="o">=</span> <span class="n">Subbot</span><span class="p">(</span><span class="s1">&#39;bot&#39;</span><span class="p">,</span> <span class="mi">11111</span><span class="p">,</span> <span class="s1">&#39;a1b2c3d4&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">bot_token</span><span class="o">=</span><span class="s1">&#39;TOKEN&#39;</span><span class="p">)</span>
<span class="n">bot</span><span class="o">.</span><span class="n">run_until_disconnected</span><span class="p">()</span>
</pre></div>
</div>
<p>Key differences:</p>
<ul class="simple">
<li><p>Telethon method names are <code class="docutils literal notranslate"><span class="pre">snake_case</span></code>.</p></li>
<li><p>dumbot does not offer friendly methods like <code class="docutils literal notranslate"><span class="pre">update.reply</span></code>.</p></li>
<li><p>Telethon does not have an implicit <code class="docutils literal notranslate"><span class="pre">on_update</span></code> handler, so
we need to manually register one.</p></li>
</ul>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="errors.html" class="btn btn-neutral float-left" title="RPC Errors" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="asyncio.html" class="btn btn-neutral float-right" title="Mastering asyncio" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017 - 2019, Lonami.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>